class Api::V1::StocksController < Api::V1::ApplicationController

  # GET /api/v1/stocks(.json) 備蓄品一覧API
  def index
    # ユーザーの家族情報から必要な備蓄品の数を求める
    stocks = []
    stock_list = [
      {
        sex: 'Male',
        age: 'Infant',
        water: 8,
        retort_rice: 0,
        retort_food: 0,
        nutritional_supplement: 0,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 0,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 0,
        lighter: 1,
        body_warmer: 0,
        contact_lenses: 0,
        battery_charger: 0,
        gloves: 0,
        newspaper: 0,
        radio: 1,
        simple_toilet: 0,
        water_supply_bag: 1,
        sanitary_item: 0,
        milk_powder: 18,
        diaper: 30,
        baby_wipe: 3,
        baby_bottle: 18,
        denture_cleaner: 0,
        prescription_drug: 0,
        ruck_sack: 1
      },
      {
        # 男性、子供(3歳~小6)
        sex: 'Male',
        age: 'Child',
        water: 8,
        retort_rice: 8,
        retort_food: 3,
        nutritional_supplement: 3,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 3,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 1,
        lighter: 1,
        body_warmer: 6,
        contact_lenses: 1,
        battery_charger: 1,
        gloves: 3,
        newspaper: 1,
        radio: 1,
        simple_toilet: 15,
        water_supply_bag: 1,
        sanitary_item: 0,
        milk_powder: 0,
        diaper: 0,
        baby_wipe: 0,
        baby_bottle: 0,
        denture_cleaner: 0,
        prescription_drug: 0,
        ruck_sack: 1
      },
      {
        # 男性、子供(中学生以上)
        sex: 'Male',
        age: 'Junior',
        water: 9,
        retort_rice: 9,
        retort_food: 3,
        nutritional_supplement: 3,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 3,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 1,
        lighter: 1,
        body_warmer: 6,
        contact_lenses: 1,
        battery_charger: 1,
        gloves: 3,
        newspaper: 1,
        radio: 1,
        simple_toilet: 15,
        water_supply_bag: 1,
        sanitary_item: 0,
        milk_powder: 0,
        diaper: 0,
        baby_wipe: 0,
        baby_bottle: 0,
        denture_cleaner: 0,
        prescription_drug: 0,
        ruck_sack: 1
      },
      {
        # 男性、成人(20歳以上)
        sex: 'Male',
        age: 'Adult',
        water: 9,
        retort_rice: 9,
        retort_food: 3,
        nutritional_supplement: 3,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 3,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 1,
        lighter: 1,
        body_warmer: 6,
        contact_lenses: 1,
        battery_charger: 1,
        gloves: 3,
        newspaper: 1,
        radio: 1,
        simple_toilet: 15,
        water_supply_bag: 1,
        sanitary_item: 0,
        milk_powder: 0,
        diaper: 0,
        baby_wipe: 0,
        baby_bottle: 0,
        denture_cleaner: 0,
        prescription_drug: 0,
        ruck_sack: 1
      },
      {
        # 男性、高齢者(65歳以上)
        sex: 'Male',
        age: 'Senior',
        water: 9,
        retort_rice: 9,
        retort_food: 3,
        nutritional_supplement: 3,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 3,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 1,
        lighter: 1,
        body_warmer: 6,
        contact_lenses: 1,
        battery_charger: 1,
        gloves: 3,
        newspaper: 1,
        radio: 1,
        simple_toilet: 15,
        water_supply_bag: 1,
        sanitary_item: 0,
        milk_powder: 0,
        diaper: 0,
        baby_wipe: 0,
        baby_bottle: 0,
        denture_cleaner: 90,
        prescription_drug: 1,
        ruck_sack: 1
      },
      {
        # 女性、乳幼児(0~2歳)
        sex: 'Female',
        age: 'Infant',
        water: 8,
        retort_rice: 0,
        retort_food: 0,
        nutritional_supplement: 0,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 0,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 0,
        lighter: 1,
        body_warmer: 0,
        contact_lenses: 0,
        battery_charger: 0,
        gloves: 0,
        newspaper: 0,
        radio: 1,
        simple_toilet: 0,
        water_supply_bag: 1,
        sanitary_item: 0,
        milk_powder: 18,
        diaper: 30,
        baby_wipe: 3,
        baby_bottle: 18,
        denture_cleaner: 0,
        prescription_drug: 0,
        ruck_sack: 1
      },
      {
        # 女性、子供(3歳~小6)
        sex: 'Female',
        age: 'Child',
        water: 8,
        retort_rice: 8,
        retort_food: 3,
        nutritional_supplement: 3,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 3,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 1,
        lighter: 1,
        body_warmer: 6,
        contact_lenses: 1,
        battery_charger: 1,
        gloves: 3,
        newspaper: 1,
        radio: 1,
        simple_toilet: 15,
        water_supply_bag: 1,
        sanitary_item: 0,
        milk_powder: 0,
        diaper: 0,
        baby_wipe: 0,
        baby_bottle: 0,
        denture_cleaner: 0,
        prescription_drug: 0,
        ruck_sack: 1
      },
      {
        # 女性、子供(中学生以上)
        sex: 'Female',
        age: 'Junior',
        water: 9,
        retort_rice: 9,
        retort_food: 3,
        nutritional_supplement: 3,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 3,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 1,
        lighter: 1,
        body_warmer: 6,
        contact_lenses: 1,
        battery_charger: 1,
        gloves: 3,
        newspaper: 1,
        radio: 1,
        simple_toilet: 15,
        water_supply_bag: 1,
        sanitary_item: 13,
        milk_powder: 0,
        diaper: 0,
        baby_wipe: 0,
        baby_bottle: 0,
        denture_cleaner: 0,
        prescription_drug: 0,
        ruck_sack: 1
      },
      {
        # 女性、成人(20歳以上)
        sex: 'Female',
        age: 'Adult',
        water: 9,
        retort_rice: 9,
        retort_food: 3,
        nutritional_supplement: 3,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 3,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 1,
        lighter: 1,
        body_warmer: 6,
        contact_lenses: 1,
        battery_charger: 1,
        gloves: 3,
        newspaper: 1,
        radio: 1,
        simple_toilet: 15,
        water_supply_bag: 1,
        sanitary_item: 13,
        milk_powder: 0,
        diaper: 0,
        baby_wipe: 0,
        baby_bottle: 0,
        denture_cleaner: 0,
        prescription_drug: 0,
        ruck_sack: 1
      },
      {
        # 女性、高齢者(65歳以上)
        sex: 'Female',
        age: 'Senior',
        water: 9,
        retort_rice: 9,
        retort_food: 3,
        nutritional_supplement: 3,
        confectionery: 3,
        canned_fruits: 3,
        wet_wipes: 30,
        alcohol_spray: 1,
        mask: 3,
        medicine: 1,
        wrap: 1,
        plastic_bag: 1,
        aluminum_foil: 1,
        toilet_paper: 2,
        tissue_paper: 2,
        flashlight: 1,
        dry_cell_battery: 1,
        lighter: 1,
        body_warmer: 6,
        contact_lenses: 1,
        battery_charger: 1,
        gloves: 3,
        newspaper: 1,
        radio: 1,
        simple_toilet: 15,
        water_supply_bag: 1,
        sanitary_item: 0,
        milk_powder: 0,
        diaper: 0,
        baby_wipe: 0,
        baby_bottle: 0,
        denture_cleaner: 90,
        prescription_drug: 1,
        ruck_sack: 1
      }
    ]
    current_user.families.each do |family|
      # Stockテーブルから家族情報の性別・年代をもとにデータを取得し、配列に格納する
      stocks << stock_list.find { |s| s[:age] == family.age && s[:sex] == family.sex }
    end

    # # hashをmergeするときに、同一keyの場合はvalueを集計する
    @sum_stocks = stocks.inject { |old_stock, new_stock|
      old_stock.merge(new_stock) { |_, old_val, new_val| old_val + new_val }
    }

    # 使わない情報をインスタンス変数から除外する
    @sum_stocks.except!(:sex, :age)

    # 防災タスクの達成状況を確認するためにタスクプロフィール情報を返す
    @task_profile = current_user.prepare_task_profile
  end

end
